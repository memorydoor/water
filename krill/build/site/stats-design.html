<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
<meta http-equiv='Content-Type' content='text/html; charset=UTF-8' />
<title>krill</title>
<link rel='stylesheet' href='maven-base.css' type='text/css' />
<link rel='stylesheet' href='maven-theme.css' type='text/css' />
<script src='report.js' type='text/javascript'> </script>
</head>
<body>
<div id='banner'>
<div id='bannerLeft'>krill</div>
<a href='http://www.oclc.org/' id='bannerRight'>
<img src='./images/mp-masthead-logo-oclc-en.gif' alt='OCLC Logo' />
</a>
<div class='clear'>&lt;hr&gt;</div>
</div>
<div id='breadcrumbs'>
<div class='xleft'>
<span id='publishDate'>Last Published: right now</span>
</div>
<div class='xright'></div>
<div class='clear'>&lt;hr&gt;</div>
</div>
<div id='leftColumn'>
<div id='navcolumn'>
<h5>Documents</h5>
<ul>
<li class='none'>
<a href='dui-component.html'>Component Level Design</a>
</li>
<li class='none'>
<a href='environments.html'>Environments</a>
</li>
<li class='none'>
<a href='stats-design.html'>UI Stats Recording Design</a>
</li>
<li class='none'>
<a href='example-html.html'>Apt Examples</a>
</li>
</ul>
<h5></h5>
<ul />
</div>
</div>
<div id='bodyColumn'>
<div id='contentBox'><div class="section"><h2>UI Statistics</h2><p>As part of the Discovery UI beta program, we were tasked to record page loads and element clicks on the pages to help our product people track exactly which UI features were being used. Several statistical tracking suites were proposed including Omniture (Site Catalyst), NewEgg and Google Analytics. We also had the additional requirement of recording all of the same information that we track externally as isoft transaction stats, so that we could produce our own reports if need be.</p><p>We decided that adding several 3rd-party javascript libraries to our project to track the same statistics seemed troublesome. We did not want to have every developer know how to add site catalyst tracking to an html link and google analytics to each element at the same time.</p><p>To facilitate this, we came up with our own statistical abstraction for each event that we cared about. We created an object for page loads, element clicks and element changes (for example a pulldown value). We added our own javascript code to these elements and pages to record things once (via an ajax request to one of our controllers).</p><p>The controller builds a java object to represent the <a class="externalLink" href="http://qualityap04qxdu.dev.oclc.org:15000/browse/DiscoveryUI/trunk/discoveryui-stats-models">event</a> and uses <a class="externalLink" href="http://docs.oracle.com/javase/tutorial/jmx/notifs/index.html">JMX Notifications</a> to publish the event object once. By using the JMX notification system, this allows us to have multiple classes subscribe to or listen for these events.</p><p>In our current design we have an <a class="externalLink" href="http://qualityap04qxdu.dev.oclc.org:15000/browse/DiscoveryUI/trunk/discoveryui-stats-isoft">iSoft listener</a> (shown as CUSP in diagram below), a <a class="externalLink" href="http://qualityap04qxdu.dev.oclc.org:15000/browse/DiscoveryUI/trunk/discoveryui-stats-site-catalyst">Site Catalyst listener</a>, and a Logger Listener. The iSoft listener can record transaction stats in iSoft (See Special iSoft section below), the Site Catalyst listener can record the statistics in Site Catalyst and the Logger listener writes our events out to our logs. (For an example of how we register a listener see <a class="externalLink" href="http://qualityap04qxdu.dev.oclc.org:15000/browse/DiscoveryUI/trunk/discoveryui-webapp/src/main/webapp/WEB-INF/application-context.xml?r=HEAD">here</a> and look for a bean named exporter)</p><p>If we needed to add a new recording mechanism (e.g. Google Analytics) then we would simply write a class that can record statistics to Google Analytics, and have that class listen for the correct types of events.</p><img src="images/counter_stats_updated.jpg" alt="" /><div class="section"><h3>Special iSoft Handling</h3><p>We have a rule that there will be no usage of iSoft code within our war file. This allows our war to be easily portable and runnable in any servlet container, not just an iSofted container. This is another reason why we chose to use JMX Notifications as the mechanism to share our stats events. Our iSoft listener is actually running in its own VM outside of Tomcat. The StatsListener process is running an iSoftListener that is subscribed to relevant events, and when an event is published, the listener records the stat in the stats DRA.</p><img src="images/isoft-stats-collection.jpg" alt="" /></div><div class="section"><h3>Useful References</h3><ul><li><a class="externalLink" href="https://developer.omniture.com/en_US/documentation/data-insertion/c-data-insertion-api">Site Catalyst Data Insertion API</a></li><li><a class="externalLink" href="https://developers.google.com/analytics/devguides/collection/">Google Analytics Collection Guide</a></li><li><a class="externalLink" href="https://developers.google.com/analytics/resources/articles/gaTrackingTroubleshooting#gifParameters">Google Analytics API Definition</a></li></ul></div></div></div>
</div>
<div id='footer'>
<p>Generated by 
<a href='http://www.gradle.org'>Gradle 1.7</a> at Oct 3, 2013 1:28:51 PM
</p>
</div>
</body>
</html>